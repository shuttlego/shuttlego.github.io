# 모바일 대응 설계 (셔틀 안내)

## 1. 현재 구조 요약

- **백엔드**: Flask, 단일 진입점 `app.py`
- **프론트**: 단일 `templates/index.html` — 인라인 CSS + vanilla JS, 카카오맵/로컬 API
- **PC 레이아웃**: 상단 헤더(출발 시각 | 검색바 | 사업장) + 본문(좌측 결과 패널 320px | 지도)
- **노선**: 현재 **1개**만 반환 (`find_nearest_stop`)

---

## 2. HTML만으로 할지, React 쓸지

### 결론: **지금 규모라면 HTML + CSS + vanilla JS로 충분하다**

| 항목 | HTML/vanilla | React |
|------|----------------|--------|
| 구조 | 단일 페이지, DOM 직접 조작 | 컴포넌트 분리, 상태 관리 |
| 빌드 | 없음 (Flask 템플릿만) | Node 빌드 필요, 배포 분리 가능 |
| 학습/유지보수 | 이미 사용 중, 진입장벽 낮음 | 새 도구·개념 필요 |
| 모바일 전용 UI | 미디어쿼리 + 클래스 토글으로 가능 | 동일 로직을 컴포넌트로 표현 |

- 모바일에서 추가되는 요소는 **레이아웃 전환**(좌측 패널 → 하단 시트), **시트 드래그**, **리스트/상태 전환** 정도라 **DOM + class 토글이면 구현 가능**하다.
- React를 도입하면 빌드 파이프라인, 상태 구조, 배포 방식이 바뀌어 **변경 범위가 커진다**. “모바일만 잘 보이게”가 목표라면 과한 선택이다.
- **나중에** 앱이 커지거나(다른 페이지·플로우·폼 많아짐) 팀이 React를 쓰기로 하면 그때 마이그레이션을 검토해도 늦지 않다.

---

## 3. 별도 모바일 페이지 vs 한 페이지 반응형

### 결론: **한 페이지 반응형(PC/모바일 겸용)을 추천한다**

- **URL·공유**: `/` 하나만 쓰면 모바일/PC 링크가 같아서 공유·북마크가 단순하다.
- **코드 일원화**: 검색·노선·지도 로직이 한 곳에 있으면, API 호출·출발/도착 플로우를 한 번만 짜고 미디어쿼리로 **보여주기만** 나누면 된다.
- **백엔드**: 라우트를 나눌 필요 없음. 기존 `/`, `/api/search`, `/api/shuttle/depart`, `/api/shuttle/arrive` 그대로 사용.
- **구현 방식**:
  - **PC**: 지금처럼 `.main-content`에서 `.results-panel`(좌측) + `.map-wrap`(우측) 유지.
  - **모바일** (예: `max-width: 768px`):  
    - 상단: 검색바 + 검색 버튼 → 그 아래: 출발 시각 + 사업장 선택 버튼 → 그 아래: 지도만 전체 너비로 표시.  
    - 결과/노선 리스트는 **화면 밖 하단**에 두었다가, 검색 시 또는 “출발/도착” 실행 시 **하단 시트(모달)** 로 올려서 보여준다.  
  - 같은 DOM을 두고, CSS `@media`와 클래스(예: `.mobile .results-panel` → 시트 스타일)로 전환하면 된다.

**별도 모바일 페이지**(예: `/m`)를 쓰는 경우:

- 장점: 모바일 전용 마크업을 완전히 다르게 가져갈 수 있음.
- 단점: 검색/노선/지도 로직을 복제하거나 공통 JS로 빼야 하고, URL이 둘로 나뉘어 “모바일 링크”를 따로 관리해야 함.

→ “화면 구성만 다르게”가 목표이므로 **한 페이지 반응형**이 유지보수와 일관성 측면에서 유리하다.

---

## 4. 모바일 화면 구성 (요구사항 정리)

### 4.1 레이아웃 (위 → 아래)

1. **상단**
   - 검색 입력 + 검색 버튼 (한 줄)
2. **그 다음 줄**
   - 출발 시각 선택 버튼(또는 텍스트)  
   - 사업장 선택 버튼(또는 드롭다운)
3. **본문**
   - 지도가 남은 세로 공간을 채움 (전체 너비)

### 4.2 하단 시트(모달) 동작

- **기본**: 지도만 보임. 시트는 숨김 또는 최소 높이(손잡이만 보이게)로 두거나, “검색어 입력 후 검색하면 여기 표시” 같은 플레이스홀더만 노출.
- **검색 후**: 시트가 **화면의 절반 정도** 올라와서 **장소 검색 결과 리스트** 표시.
- **드래그**:
  - 아래로 당기면 → 시트가 내려가서 지도가 전부 보이게 (반쯤 또는 닫힘).
  - 위로 당기면 → 시트가 올라와서 지도를 거의 다 덮음 (전체 화면에 가깝게).
- 시트 내부는 **스크롤 가능** 리스트로, 장소 카드 탭 시 “선택” 상태로 두고 출발/도착 버튼 노출 (현재 PC의 `.card-actions`와 동일 역할).

### 4.3 플로우

1. 사용자가 장소 검색 → 결과가 하단 시트 리스트에 표시.
2. 장소 선택 → 해당 카드에 출발 / 도착 버튼 표시.
3. **출발** 또는 **도착** 탭 → (백엔드 확장) **가까운 노선 3개** 조회 → 시트 내용을 “노선 3개 리스트”로 전환.
4. 노선 1개 선택 → 지도에 해당 노선만 표시 (경로선 + 탑승/하차 포인트). 시트는 반쯤 내리거나 유지해서 지도가 보이게.

---

## 5. 기술적 포인트 (구현 시 참고)

### 5.1 하단 시트(드래그 가능 모달)

- **HTML**: 예) `.bottom-sheet` 하나로 감싸고, 그 안에 `.bottom-sheet-handle`(드래그 영역) + `.bottom-sheet-content`(리스트/플레이스홀더).
- **위치**: PC에서는 이 블록을 `display: none` 또는 “우측 지도 아래”가 아니라 **좌측 결과 패널**만 보이게 하고, 모바일 미디어쿼리에서만 `.results-panel`을 시트처럼 보이게 할 수 있다.  
  더 단순하게 가려면: **모바일에서만** “결과/노선을 보여주는 영역”을 시트로 스타일링하고, **같은 `resultsList` / 같은 DOM**을 시트 안에 두면 된다 (즉, 리스트 DOM은 하나, PC에서는 좌측 패널로, 모바일에서는 시트 내용으로 사용).
- **드래그**: `touchstart` / `touchmove` / `touchend`로 Y 이동량을 구해 시트의 `height` 또는 `transform: translateY(...)` 로 단계(예: 0%, 50%, 100%) 고정. 또는 CSS `height: 50vh` / `height: 90vh` 클래스 토글로 “절반 / 거의 전체” 두 단계만 해도 된다.

### 5.2 노선 3개

- **백엔드**: `load_data.py`에 “가까운 정류장 기준 상위 N개 노선”을 반환하는 함수 추가 (예: `find_nearest_stops(site_id, route_type, lat, lng, limit=3)`).
- **API**:  
  - 기존 `/api/shuttle/depart`, `/api/shuttle/arrive`를 **배열**을 반환하도록 확장하거나,  
  - 새 엔드포인트 `/api/shuttle/depart/options`, `/api/shuttle/arrive/options`처럼 “노선 후보 N개” 전용을 두고,  
  - 프론트는 “노선 후보 리스트”를 시트에 뿌린 뒤, 하나 선택 시 해당 노선만 지도에 그리는 식으로 가면 된다.
- **프론트**: 시트 내용을 “장소 리스트” ↔ “노선 리스트”로 전환하는 **뷰 모드**만 두면 된다 (같은 시트, 다른 리스트 렌더링).

### 5.3 지도 터치

- 모바일에서는 지도 클릭 시 말풍선(출발/도착)이 나오는 현재 동작을 유지해도 된다. 다만 손가락으로 누를 때 클릭/드래그 구분을 위해 **짧은 탭만** 말풍선 열기, 지도 드래그는 그대로 두는 식으로 처리하면 된다.

---

## 6. 정리

| 주제 | 권장 |
|------|------|
| **HTML vs React** | 현재 규모에서는 **HTML + vanilla JS 유지**. 모바일 레이아웃/시트는 DOM + CSS로 처리 가능. |
| **별도 모바일 페이지 vs 한 페이지** | **한 페이지 반응형**. 같은 URL·같은 로직, 미디어쿼리와 시트 UI로 모바일만 다르게 보이게. |
| **모바일 UI** | 상단 검색 → 출발/사업장 버튼 → 지도; 결과/노선은 **하단 드래그 가능 시트**에서 리스트로 표시. |
| **노선 3개** | 백엔드에서 “가까운 N개 노선” API 추가 후, 시트에서 노선 리스트 → 선택 시 지도에 1개 노선 표시. |

이렇게 설계한 뒤, **같은 `index.html` 안에서**  
(1) 미디어쿼리로 모바일 레이아웃 분기,  
(2) 모바일일 때만 하단 시트 마크업/스타일 적용,  
(3) 시트 드래그 로직과 “장소 리스트 / 노선 리스트” 뷰 전환만 추가하면,  
기존 HTML 구조를 유지한 채로 모바일에서 원하는 동작을 맞출 수 있다.
